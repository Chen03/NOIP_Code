# 19.08.03 纪中讲评总结--DP专题

## A.M. 斜率优化与杂七杂八？

### NOIP2018 摆渡车

- 把模型抽象成在坐标轴上有若干个点，要求在轴上选取一些点（间距$\ge m$），使得原来的点与各自右边最近的选择点距离之和最短。

- 设$F_i$为时刻i的最小等待时间，可以得到转移方程：

$$
F_i=\min\limits_{0\leq j\leq i-m} \{ F_j + \sum^{i}_{k=j+1} c_k * (i-k) \}
$$

- 前缀和优化：

$$
S1=\sum_k c_k \\
S2=\sum_k c_k*k \\
F_i=\min\limits_{0\leq j\leq i-m} \{ F_j + i*(S1_i-S1_j)-(S2_i-S2_j) \}
$$

- min消去，把与$j$有关的量$Fj \ S1_j \ S2_j$视作变量，$i$视作斜率，得到：

$$
F_i=F_j-i*S1_j+S2_j+i*S1_i-S2_i
$$

---

于是接下来就很迷惹……理论上按蓝书讲应该是$F_j$作y，$S1_j$什么的视作x，但是这里行不通（两个自变量……），于是按上午讲课的方法，直接不等式（设$j<k$）

$$
F_j-i*S1_j+S2_j+i*S1_i-S2_i < F_k-i*S1_k+S2_k+i*S1_i-S2_i
$$

- 移项，得

$$
F_j-F_k < (S1_j-S1_k)*i - S2_j + S2_k
$$

---

- 正解发现！把$Fj \ S2_j$视作y，$S1_j$视作x，$i$视作k，其他视作b，可得：

$$
\underline{F_j+S2_j}_y=\underline{i}_k*\underline{S1_i}_x+\underline{F_i-i*S1_j+S2_i}_b
$$

- 优先队列储存决策过程：

1. 用队列储存最优决策，当队首满足:
$$
\frac{F_l+S2_l-F_{l+1}-S2_{l+1}}{S1_l-S1_{l+1}} < i
$$
- 队首出队。

2. 用队首的决策`li[l]`转移
3. 把当前的决策入队并检查：

$$
\frac{F_r+S2_r-F_{r+1}-S2_{r+1}}{S1_r-S1_{r+1}} < \frac{F_{r+1}+S2_{r+1}-F_{now}-S2_{now}}{S1_{r+1}-S1_{now}}
$$

- 如果成立，你就可以$\mathop{出队}\limits_{退役}$了。